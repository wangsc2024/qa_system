# TDD 全部模組測試實施計畫

本計畫旨在透過測試驅動開發 (TDD) 的方式，為 `qa_system` 的所有模組建立完整的測試覆蓋，確保系統的穩定性與正確性。

## 1. 測試環境確認與優化
- [ ] 確認 `pytest` 及其相關依賴 (如 `httpx`, `sqlalchemy`) 已安裝。
- [ ] 檢查並優化 `tests/conftest.py`，確保資料庫隔離與 `TestClient` 配置正確。
- [ ] 執行現有的 `tests/test_models.py` 確保基礎環境無誤。

## 2. 身份驗證與密鑰模組 (`app/routers/auth.py`)
- [ ] **測試清單**:
    - 登入 API (`/auth/login`)：正確與錯誤的憑據。
    - 取得目前使用者 (`/users/me`)：攜帶有效與無效 Token。
    - 權限驗證邏輯：確保不同角色的存取權限受到保護。
- [ ] **目標**: 確保系統入口與權限控管無虞。

## 3. 使用者與角色管理 (`app/routers/users.py`, `app/routers/roles.py`)
- [ ] **測試清單**:
    - 使用者的 CRUD 操作。
    - 角色的 CRUD 操作。
    - 使用者角色分配與變更。
- [ ] **目標**: 保證使用者與權限資料的一致性。

## 4. 部門架構模組 (`app/routers/departments.py`)
- [ ] **測試清單**:
    - 部門 CRUD。
    - 部門層級關係（父子部門）驗證。
    - 局處辨識邏輯 (`is_bureau`)。
- [ ] **目標**: 確保組織架構邏輯正確。

## 5. 提問與回覆核心模組 (`app/routers/questions.py`, `app/routers/reports.py`)
- [ ] **測試清單**:
    - 提問建立、修改、刪除。
    - 指定通報/回答部門。
    - 提問狀態流轉（待處理 -> 已關閉等）。
    - 回覆內容的新增與檢視。
    - 通報與回答的權限控管（僅限被指定的部門回覆）。
- [ ] **目標**: 確保核心業務邏輯的正確性與資料安全性。

## 6. 資料匯出模組 (`app/routers/export.py`)
- [ ] **測試清單**:
    - 匯出提問列表。
    - 匯出報表。
    - 確保匯出檔案格式正確且內容齊全。
- [ ] **目標**: 確保輸出資料的正確性。

## 運行與驗證方式
- 使用 `pytest` 執行所有測試。
- 使用 `pytest --cov=app` 查看測試覆蓋率（選配）。

---
**預計進度**: 依照上述 2-6 的順序逐一實作測試與重構程式碼。
